function getRandomInt(min, max)
{
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function getRandomArray (size, min, max ){
    min = min || 0;
    max = max || 250
    res = Array();
    while (size-- > 0)
    {
        res.push (getRandomInt(min,max))
    }
    return res;
}

addArrays = function (arr1, arr2)
{
    for (i=0; i < arr1.length; i++){
        arr1[i] += arr2[i];
    }
    //console.log (arr1)
    return arr1;
}

current_value = 'fin'
var setNewValues = function () {
    current_value =  $(this).parent().attr("data")
    redrawStatusChart();
}


//var current_status_data = finance_status_data;
$(function (){
    status_chart=new Highcharts.Chart({
        credits:  {
            enabled: false
        },
        chart: {
            renderTo:'apartment-status-chart',
            type: 'column'
        },
        title: {
            text: 'Статусы квартир'
        },
        xAxis: {
            categories: getWeeksCategories()
        },
        yAxis:{
            title: {
                text: ''
            }
        },
        tooltip: {
            shared: true
//            formatter: function() {
//                var s = '<b>'+ this.x +'</b>';
//
//                $.each(this.points, function(i, point) {
//                    s += '<br/>'+ point.series.name +': '+
//                            point.y + " " + current_status_data['valueSuffix'];
//                });
//
//                return s;
//            }
//              valueSuffix: 'млн рублей'
        },
        series: []
    });

    redrawStatusChart = function(){
        weeks_group={
            'ПС':[],
            'ДКП':[],
            'Аукцион':[],
            'Имеет заявку': [],
            'Свободна': []
        };
        $.each(filtered_apartments, function(i,val){

            ps_date = moment(val.ps_date||0)
            dkp_date = moment(val.dkp_date||0)
            auk_date = moment(val.auction_date||0)
            has_qty_date = moment(val.has_qty_date||0)
            free_date = moment(val.free_date||0)
            $.each(getWeeksStarts(), function(t,week){
                if (weeks_group['ПС'][t]==null) weeks_group['ПС'][t]={count:0, fin:0, m2:0}
                if (ps_date.diff(week, 'days')>=0 && ps_date.diff(week, 'days')<7)
                {
                    weeks_group['ПС'][t]['count']++;
                    weeks_group['ПС'][t]['fin']+=val.end_summ
                    weeks_group['ПС'][t]['m2']+=val.square
                }
                if (weeks_group['ДКП'][t]==null) weeks_group['ДКП'][t]={count:0, fin:0, m2:0}
                if (dkp_date.diff(week, 'days')>=0 && dkp_date.diff(week, 'days')<7)
                {
                    weeks_group['ДКП'][t]['count']++;
                    weeks_group['ДКП'][t]['fin']+=val.end_summ
                    weeks_group['ДКП'][t]['m2']+=val.square
                }
                if (weeks_group['Аукцион'][t]==null) weeks_group['Аукцион'][t]={count:0, fin:0, m2:0}
                if (dkp_date.diff(week, 'days')>=0 && dkp_date.diff(week, 'days')<7)
                {
                    weeks_group['Аукцион'][t]['count']++;
                    weeks_group['Аукцион'][t]['fin']+=val.end_summ
                    weeks_group['Аукцион'][t]['m2']+=val.square
                }
                if (weeks_group['Имеет заявку'][t]==null) weeks_group['Имеет заявку'][t]={count:0, fin:0, m2:0}
                if (dkp_date.diff(week, 'days')>=0 && dkp_date.diff(week, 'days')<7)
                {
                    weeks_group['Имеет заявку'][t]['count']++;
                    weeks_group['Имеет заявку'][t]['fin']+=val.end_summ
                    weeks_group['Имеет заявку'][t]['m2']+=val.square
                }
                if (weeks_group['Свободна'][t]==null) weeks_group['Свободна'][t]={count:0, fin:0, m2:0}
                if (dkp_date.diff(week, 'days')>=0 && dkp_date.diff(week, 'days')<7)
                {
                    weeks_group['Свободна'][t]['count']++;
                    weeks_group['Свободна'][t]['fin']+=val.end_summ
                    weeks_group['Свободна'][t]['m2']+=val.square
                }
            })
        })


        weeks_data = {};
        console.log(weeks_group)
        $.each(weeks_group, function(i,status_data){
            console.log(status_data)
            if(weeks_data[i]==null) weeks_data[i]={name: i,data:[]}

            $.each(status_data, function(t, week_status_data){
                weeks_data[i]['data'].push(week_status_data[current_value])
            })

        })

        while(status_chart.series.length > 0)
            status_chart.series[0].remove(false);
        $.each (weeks_data, function (i,ser){
            status_chart.addSeries(ser, false);
        })
        status_chart.redraw();
    }

    redrawStatusChart();
});







